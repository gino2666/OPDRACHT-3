<!DOCTYPE html>
<html lang="nl">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>SpaceX Dashboard</title>
		<link type="text/css" href="styles/style.css" rel="stylesheet"/>
		<link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.css">
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"> </script>
		<script src="https://api.mapbox.com/mapbox-gl-js/v1.9.0/mapbox-gl.js"></script>
		<link href="https://api.mapbox.com/mapbox-gl-js/v1.9.0/mapbox-gl.css" rel="stylesheet" />

	</head>
	<body>

		<input type="checkbox" id="nav-toggle">
		<div class="sidebar">
			<div class="sidebar-brand">
				<h2><span class="las la-rocket"></span> <span>SpaceX</span> </h2>
			</div>

			<div class="sidebar-menu">
				<ul>
					<li><a href="" class="active"><span class="las la-igloo"></span>
					<span>Dashboard</span></a>
					</li>
					<li><a href=""><span class="las la-users"></span>
					<span>Service</span></a>
					</li>
					<li><a href=""><span class="las la-clipboard-list"></span>
					<span>Missions</span></a>
					</li>
					<li><a href=""><span class="las la-user-cog"></span>
					<span>Settings</span></a>
					</li>
				</ul>
			</div>
		</div>

		<div class="main-content">
			<header>
				<h3>
					<label for="nav-toggle">
						<span class="las la-bars"></span>
					</label>
					Dashboard
				</h3>

				<div class="user-wrapper">
					<img src="images/mike.jpg" width="50px" height="50px" alt="user">
					<div>
						<h4> Mike James </h4>
						<small> pilot </small>
					</div>
				</div>			
			</header>

			<main>
				<h1>Vehicle Information</h1>
				<div class="cards">					
					<div class="card-single">
						<div>
							<h2>125.8 g/L</h2>
							<span>Fuel</span>
						</div>
						<div>
							<span class="las la-gas-pump"></span>
						</div>
					</div>
					<div class="card-single">
						<div>
							<h2>0</h2>
							<span>Acceleration</span>
						</div>
						<div>
							<span class="las la-fighter-jet"></span>
						</div>
					</div>
					<div class="card-single">
						<div>
							<h2>0 km/h</h2>
							<span>Speed</span>
						</div>
						<div>
							<span class="las la-tachometer-alt"></span>
						</div>
					</div>
				</div>
				<div class="recent-grid">
					<div class="voorraden">
						<div class="card" id="map">
							<div class="card-header"></div>
						</div>
					</div>
				</div>

			

				
			</main>
		</div>
		
	</body>
</html>

<script type="text/javascript">

// Set api token for mapbox
mapboxgl.accessToken = 'pk.eyJ1IjoiZ2lubzI2NjYiLCJhIjoiY2tuNXhoYzJtMDhyejJ3cDRkZXl0d2M2biJ9._-peIWBWKlBxGpeGNb7S4A';

// api token for openWeatherMap
var openWeatherMapUrl = 'https://api.openweathermap.org/data/2.5/weather';
var openWeatherMapUrlApiKey = '3c68a7ea5b54e68c18d03bf16d0de18a';

// Determine cities
var cities = [
  {
    name: 'Amsterdam',
    coordinates: [4.895168, 52.370216]
  },
  {
    name: 'Rotterdam',
    coordinates: [4.47917, 51.9225]
  },
  {
    name: 'Nijmegen',
    coordinates: [5.85278, 51.8425]
  },
  {
    name: 'Maastricht',
    coordinates: [5.68889, 50.84833]
  },
  {
    name: 'Groningen',
    coordinates: [6.56667, 53.21917]
  },
  {
    name: 'Enschede',
    coordinates: [6.89583, 52.21833]
  },
];

// Initiate map
var map = new mapboxgl.Map({
  container: 'map',
  style: 'mapbox://styles/mapbox/outdoors-v11',
  center: [5.508852, 52.142480],
  zoom: 7
});


// get weather data and plot on map
map.on('load', function () {
  cities.forEach(function(city) {
    // Usually you do not want to call an api multiple times, but in this case we have to
    // because the openWeatherMap API does not allow multiple lat lon coords in one request.
    var request = openWeatherMapUrl + '?' + 'appid=' + openWeatherMapUrlApiKey + '&lon=' + city.coordinates[0] + '&lat=' + city.coordinates[1];

    // Get current weather based on cities' coordinates
    fetch(request)
      .then(function(response) {
        if(!response.ok) throw Error(response.statusText);
        return response.json();
      })
      .then(function(response) {
        // Then plot the weather response + icon on MapBox
        plotImageOnMap(response.weather[0].icon, city)
      })
      .catch(function (error) {
        console.log('ERROR:', error);
      });
  });
});

function plotImageOnMap(icon, city) {
  map.loadImage(
    'http://openweathermap.org/img/w/' + icon + '.png',
    function (error, image) {
      if (error) throw error;
      map.addImage("weatherIcon_" + city.name, image);
      map.addSource("point_" + city.name, {
        type: "geojson",
        data: {
          type: "FeatureCollection",
          features: [{
            type: "Feature",
            geometry: {
              type: "Point",
              coordinates: city.coordinates
            }
          }]
        }
      });
      map.addLayer({
        id: "points_" + city.name,
        type: "symbol",
        source: "point_" + city.name,
        layout: {
          "icon-image": "weatherIcon_" + city.name,
          "icon-size": 1.3
        }
      });
    }
  );
}
</script>